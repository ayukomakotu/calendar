<div class="achieve">
    <h1>実績一覧</h1>
    <h3>当日受注表</h3>
    <div class="scroll_parallel">
        <table class="table">
            <tr>
                <th>名前</th>
                <th>当日売上</th>
                <th>月累計</th>
                <th>目標</th>
                <th>不足</th>
                <th>目標達成率</th>
            </tr>
            <% @users.each do |user| %>
                <tr>
                    <td><%= user.name %></td>
                    <td><%= user.today_achievement %></td>
                    <td><%= user.monthly_achievement(Date.today) %></td>
                    <td><%= user.monthly_target(Date.today.year, Date.today.month) %></td>
                    <td><%= user.monthly_achievement(Date.today) - user.monthly_target(Date.today.year, Date.today.month) %></td>
                    <td><%= (user.monthly_achievement(Date.today).to_f/user.monthly_target(Date.today.year, Date.today.month).to_f) * 100 %>%</td>
                </tr>
            <% end %>
            <tr>
                <td>全体</td>
                <td>
                    <%= User.all.map{ |user| user.today_achievement }.sum %>
                </td>
                <td>
                    <%= User.all.map{ |user| user.monthly_achievement(Date.today) }.sum %>
                </td>
                <td><%= Target.find_by(office_id: 1, year: 2022).attributes["tr_#{Date.today.month}"] %></td>
                <td>
                    <%= User.all.map{ |user| user.monthly_achievement(Date.today) }.sum -
                        Target.find_by(office_id: 1, year: 2022).attributes["tr_#{Date.today.month}"] %>
                </td>
                <td>
                    <%= (User.all.map{ |user| user.monthly_achievement(Date.today) }.sum.to_f /
                    Target.find_by(office_id: 1, year: 2022).attributes["tr_#{Date.today.month}"]).floor(3) * 100 %>%
                </td>

            </tr>
        </table>
    </div>
</div>